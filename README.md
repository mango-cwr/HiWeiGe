# 中国电信账单差异对比工具

## 工具介绍

该工具专为中国电信客户经理设计，用于对比不同月份的客户账单差异。通过简单的命令操作，您可以快速分析客户欠费情况的变化，识别异常波动，为客户服务提供数据支持。

## 功能特点

- **支持多种文件格式**：可读取Excel (.xlsx, .xls) 和CSV格式的数据文件
- **智能月份识别**：自动从账务周期中提取月份信息
- **灵活的月份选择**：支持命令行参数指定月份或交互式选择
- **详细的差异分析**：计算每个设备的金额差异和百分比差异
- **汇总统计**：提供总差异、平均差异和差异最大的设备等汇总信息
- **结果导出**：支持将对比结果导出为Excel或CSV文件

## 安装依赖

### 前提条件

- Python 3.6 或更高版本

### 安装步骤

1. 克隆或下载本项目到本地
2. 安装必要的Python包：

```bash
pip install pandas openpyxl
```

## 使用方法

### 基本用法

```bash
python bill_comparator.py <数据文件路径>
```

例如：

```bash
python bill_comparator.py test_data.xlsx
```

### 命令行参数

- `file`：（必需）数据文件路径
- `--month1`：（可选）第一个对比月份，格式为 YYYY-MM
- `--month2`：（可选）第二个对比月份，格式为 YYYY-MM
- `--output`：（可选）输出结果文件路径

### 交互式使用

如果不指定 `--month1` 和 `--month2` 参数，程序会自动检测数据中的可用月份，并提示您选择要对比的两个月份。

### 示例

#### 示例1：交互式选择月份

```bash
python bill_comparator.py test_data.xlsx
```

输出：

```
成功加载数据文件，共 18 条记录

数据中可用的月份:
1. 2024-07
2. 2024-08
3. 2024-09

请选择要对比的两个月份:
请输入第一个月份的编号 (1-3): 1
请输入第二个月份的编号 (1-3): 2

正在对比 2024-07 和 2024-08 的账单差异...

对比结果:
       设备号码  账单费用_2024-07  账单费用_2024-08  差异金额  差异百分比
0  13800138001          128.5          132.8    4.30      3.35
1  13800138002           99.0           99.0    0.00      0.00
2  13800138003          156.75         168.5   11.75      7.50
3  13800138004           88.2           75.6  -12.60    -14.29
4  13800138005          210.3         220.75   10.45      4.97
5  13800138006            0.0          145.2  145.20        inf

汇总信息:
总差异金额: 160.10
平均差异金额: 26.68
差异最大的设备: 13800138006 (差异: 145.20)

结果已保存到: bill_comparison_2024-07_vs_2024-08.xlsx
```

#### 示例2：命令行指定月份和输出路径

```bash
python bill_comparator.py test_data.xlsx --month1 2024-08 --month2 2024-09 --output comparison_result.csv
```

## 数据格式要求

数据文件必须包含以下三列：

| 列名 | 描述 | 格式示例 |
|------|------|----------|
| 设备号码 | 客户使用的产品号码 | 13800138001 |
| 账务周期 | 账单所属的时间段 | [20240701]2024-07-01:2024-07-31 |
| 账单费用 | 该业务的欠费金额 | 128.50 |

## 常见问题

1. **问题**：加载数据失败
   **解决方法**：检查数据文件路径是否正确，确保文件格式为Excel或CSV，且包含必要的列。

2. **问题**：月份选择后没有数据
   **解决方法**：检查所选月份是否在数据文件中存在，确保账务周期格式正确。

3. **问题**：导出结果失败
   **解决方法**：检查输出文件路径是否有写入权限，确保文件格式为Excel或CSV。

4. **问题**：差异百分比显示为inf
   **解决方法**：这表示第一个月份的账单费用为0，无法计算百分比差异，属于正常情况。

## 测试数据

本项目提供了 `test_data.xlsx` 测试数据文件，包含2024年7月、8月、9月三个月份的账单信息，共18条记录，涵盖了7个设备号码的欠费情况。您可以使用此文件测试工具的各项功能。

## 注意事项

- 确保数据文件中的"账务周期"格式与示例一致，否则可能无法正确提取月份信息
- 对于大型数据文件，可能需要较长的处理时间
- 建议定期备份原始数据文件，以防数据丢失

## 联系方式

如有任何问题或建议，请联系工具开发者。
